<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integrated Structural Design Suite</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Chart.js for diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #171822; /* Darker background */
            color: #e5e7eb;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            width: 100%;
            max-width: 1024px;
            padding: 2rem;
        }
        .nav-button {
            transition: all 0.2s;
        }
        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(79, 70, 229, 0.4);
        }
        .diagram-canvas {
            background-color: #28293d; /* Diagram background */
            border-radius: 0.75rem;
            padding: 1rem;
            height: 400px; /* Fixed height for diagram area */
        }
    </style>
</head>
<body onload="initApp()">

    <div class="container">
        <!-- Header -->
        <header class="text-center py-6 mb-8 bg-[#28293d] rounded-xl shadow-lg">
            <h1 class="text-3xl md:text-4xl font-extrabold text-indigo-400">
                Integrated Structural Design Suite
            </h1>
            <p class="text-sm text-gray-400 mt-1">
                IS 456:2000 Code Checks and Visualization Tools
            </p>
        </header>

        <!-- Navigation Tabs -->
        <nav class="flex justify-center space-x-2 md:space-x-4 mb-8">
            <button onclick="navigate('MuVuCheck')" class="nav-button bg-gray-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-700">
                Mᵤ/Vᵤ Check
            </button>
            <button onclick="navigate('SFDBMD')" class="nav-button bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm font-medium shadow-xl">
                SFD & BMD Diagrams
            </button>
            <button onclick="navigate('SlabTool')" class="nav-button bg-gray-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-700">
                Slab Estimation Tool
            </button>
            <button onclick="navigate('CantileverDesign')" class="nav-button bg-gray-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-700">
                Cantilever Beam Design
            </button>
            <button onclick="navigate('DesignHistory')" class="nav-button bg-gray-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-700">
                Design History
            </button>
        </nav>

        <!-- Main Content Area -->
        <main id="content-area" class="p-6 bg-[#212130] rounded-xl shadow-xl border border-[#3a3b4f]">
            <!-- SFD & BMD Content (Default View) -->
            <div id="SFDBMD-view" class="active-view">
                <h2 class="text-2xl font-bold text-indigo-300 mb-4 text-center">Shear Force and Bending Moment Diagrams (UDL)</h2>
                
                <!-- Input Parameters (Simplified for UDL Example) -->
                <div class="flex flex-col md:flex-row gap-4 mb-6 justify-center">
                    <div class="flex items-center space-x-2">
                        <label for="spanLength" class="text-gray-400">Span Length (L, m):</label>
                        <input type="number" id="spanLength" value="5" min="1" step="0.1"
                               class="bg-gray-700 text-white p-2 rounded-lg w-20 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div class="flex items-center space-x-2">
                        <label for="udlValue" class="text-gray-400">UDL (w, kN/m):</label>
                        <input type="number" id="udlValue" value="20" min="0.1" step="0.1"
                               class="bg-gray-700 text-white p-2 rounded-lg w-20 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                </div>

                <!-- Diagram Controls -->
                <div class="flex justify-center space-x-4 mb-8">
                    <button onclick="drawDiagram('BMD')" id="bmd-button"
                            class="bg-purple-600 text-white px-6 py-3 rounded-xl font-semibold shadow-md hover:bg-purple-700 transition duration-150">
                        Show Bending Moment Diagram
                    </button>
                    <button onclick="drawDiagram('SFD')" id="sfd-button"
                            class="bg-indigo-600 text-white px-6 py-3 rounded-xl font-semibold shadow-md hover:bg-indigo-700 transition duration-150">
                        Show Shear Force Diagram
                    </button>
                </div>

                <!-- Result and Canvas -->
                <div id="diagram-output" class="text-center mb-6 text-xl text-green-400 font-mono">
                    
                </div>
                
                <div class="diagram-canvas">
                    <canvas id="diagramCanvas"></canvas>
                </div>

                <div class="mt-8 p-4 bg-[#3a3b4f] rounded-lg">
                    <p class="text-sm text-gray-400 italic">
                        Note: Calculations assume a **Simply Supported Beam with UDL**.
                        <br>Max Values: $M_{max} = \frac{wL^2}{8}$, $V_{max} = \frac{wL}{2}$.
                    </p>
                </div>
            </div>

            <!-- Placeholder for other views -->
            <div id="MuVuCheck-view" class="hidden text-center text-gray-500">Mᵤ/Vᵤ Check Content</div>
            <div id="SlabTool-view" class="hidden text-center text-gray-500">Slab Estimation Tool Content</div>
            <div id="CantileverDesign-view" class="hidden text-center text-gray-500">Cantilever Beam Design Content</div>
            <div id="DesignHistory-view" class="hidden text-center text-gray-500">Design History Content</div>

        </main>
        <!-- Footer -->
        <footer class="mt-10 pt-6 text-center text-gray-500 border-t border-[#3a3b4f] w-full max-w-4xl">
            <p class="text-sm">Developed by Arif Ahmad, Civil Engineer (2025)</p>
            <p class="text-xs mt-2">Disclaimer: All calculations are based on assumed values and simplified models for educational and preliminary purposes.</p>
        </footer>
    </div>

    <script>
        // Global variables for Chart.js instance and current view
        let sfdBmdChart = null;
        let currentDiagramType = 'BMD'; // Default to Bending Moment Diagram

        // --- Core Application Logic ---
        function initApp() {
            // Ensure Chart.js is ready before drawing
            setupChart();
            // Attach event listeners to input fields
            document.getElementById('spanLength').addEventListener('change', updateDiagram);
            document.getElementById('udlValue').addEventListener('change', updateDiagram);
            // Draw initial diagram
            drawDiagram(currentDiagramType);
        }

        function navigate(viewId) {
            document.querySelectorAll('.active-view').forEach(view => {
                view.classList.replace('active-view', 'hidden');
            });
            const targetView = document.getElementById(viewId + '-view');
            if (targetView) {
                targetView.classList.replace('hidden', 'active-view');
            }
        }
        
        // --- Structural Calculation Functions ---
        function calculateUDLValues(L, w) {
            // Simply Supported Beam with UDL 'w' over span 'L'
            const M_max = (w * L * L) / 8; // Bending Moment at center
            const V_max = (w * L) / 2;     // Shear Force at support
            
            return { L, w, M_max: M_max.toFixed(2), V_max: V_max.toFixed(2) };
        }

        // --- Chart/Diagram Logic ---

        function setupChart() {
            const ctx = document.getElementById('diagramCanvas').getContext('2d');
            
            // Destroy existing chart instance if it exists
            if (sfdBmdChart) {
                sfdBmdChart.destroy();
            }

            sfdBmdChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [0, 1, 2, 3, 4, 5], // Example labels, will be overwritten
                    datasets: []
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 500
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                title: (items) => `Position: ${items[0].label} m`,
                                label: (item) => `${item.dataset.label}: ${item.formattedValue} kN${currentDiagramType === 'BMD' ? '.m' : ''}`
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            title: {
                                display: true,
                                text: 'Distance (m)',
                                color: '#9ca3af'
                            },
                            grid: {
                                color: '#4b5563'
                            },
                            ticks: {
                                color: '#e5e7eb'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: currentDiagramType === 'BMD' ? 'Bending Moment (kN.m)' : 'Shear Force (kN)',
                                color: '#9ca3af'
                            },
                            grid: {
                                color: '#4b5563'
                            },
                            ticks: {
                                color: '#e5e7eb'
                            }
                        }
                    }
                }
            });
        }

        function generateSFDData(L, w) {
            const numPoints = 51; // Number of points for smooth curve
            const labels = [];
            const data = [];

            // SF(x) = wL/2 - w*x 
            for (let i = 0; i < numPoints; i++) {
                const x = (i / (numPoints - 1)) * L;
                const V_x = (w * L / 2) - (w * x);

                labels.push(x.toFixed(2));
                data.push(V_x.toFixed(2));
            }

            return { labels, data };
        }

        function generateBMDData(L, w) {
            const numPoints = 51; // Number of points for smooth curve
            const labels = [];
            const data = [];

            // BM(x) = (wL/2)*x - (w*x^2)/2
            for (let i = 0; i < numPoints; i++) {
                const x = (i / (numPoints - 1)) * L;
                const M_x = (w * L * x / 2) - (w * x * x / 2);
                
                labels.push(x.toFixed(2));
                data.push(M_x.toFixed(2));
            }

            return { labels, data };
        }

        function updateDiagram() {
            // Trigger drawing based on the currently selected diagram type
            drawDiagram(currentDiagramType);
        }

        function drawDiagram(type) {
            currentDiagramType = type;
            const L = parseFloat(document.getElementById('spanLength').value) || 1;
            const w = parseFloat(document.getElementById('udlValue').value) || 0.1;
            
            if (L <= 0 || w <= 0) {
                document.getElementById('diagram-output').innerHTML = '<span class="text-red-500">Please enter positive values for L and w.</span>';
                if(sfdBmdChart) sfdBmdChart.data.datasets = [];
                sfdBmdChart.update();
                return;
            }

            const calcs = calculateUDLValues(L, w);
            let dataObject;
            let title;
            let lineColor;
            let backgroundColor;

            // --- SFD (Linear Function) ---
            if (type === 'SFD') {
                dataObject = generateSFDData(L, w);
                title = `Max Shear Force (Vₘₐₓ): ${calcs.V_max} kN`;
                lineColor = '#4f46e5'; // Indigo
                backgroundColor = 'rgba(79, 70, 229, 0.3)';
                
            // --- BMD (Parabolic Function) ---
            } else { // 'BMD'
                dataObject = generateBMDData(L, w);
                title = `Max Bending Moment (Mₘₐₓ): ${calcs.M_max} kN.m`;
                lineColor = '#9333ea'; // Purple
                backgroundColor = 'rgba(147, 51, 234, 0.3)';
            }
            
            // Update output display
            document.getElementById('diagram-output').textContent = title;

            // Prepare chart data structure
            const newDatasets = [{
                label: type,
                data: dataObject.data.map((val, index) => ({ x: parseFloat(dataObject.labels[index]), y: parseFloat(val) })),
                borderColor: lineColor,
                backgroundColor: backgroundColor,
                borderWidth: 2,
                fill: true,
                pointRadius: 0,
                tension: type === 'BMD' ? 0.3 : 0, // Parabola for BMD, straight lines for SFD
                stepped: type === 'SFD' ? 'before' : false, // Shear is technically piecewise, but linear is close enough for UDL. Use tension 0 for straight line.
                segment: {
                    borderColor: ctx => type === 'SFD' ? lineColor : undefined,
                }
            }];
            
            // Reinitialize chart with new scales
            setupChart(); 
            
            // Set new data
            sfdBmdChart.data.labels = dataObject.labels;
            sfdBmdChart.data.datasets = newDatasets;
            
            // Manually set X-axis scale min/max to L
            sfdBmdChart.options.scales.x.min = 0;
            sfdBmdChart.options.scales.x.max = L;
            
            // Set Y-axis title based on type
            sfdBmdChart.options.scales.y.title.text = type === 'BMD' ? 'Bending Moment (kN.m)' : 'Shear Force (kN)';
            
            // Update the chart
            sfdBmdChart.update('none'); // 'none' prevents animation which is good for quick redraws
        }

    </script>
</body>
</html>
