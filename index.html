<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Civil Structural Design Suite - v3.0</title>
    <meta name="description" content="Advanced structural design and analysis suite with modular architecture, interactive visuals, and enhanced reporting.">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.2.1/dist/chartjs-plugin-annotation.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-50 transition-colors duration-300">
    <div id="loading" class="fixed inset-0 bg-white z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-gray-600 text-lg font-medium">Initializing Civil Suite v3.0...</p>
            <div id="loading-details" class="text-gray-500 text-sm mt-2">Loading engineering modules</div>
            <div class="w-64 bg-gray-200 rounded-full h-2 mt-4 mx-auto">
                <div id="loading-progress" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
        </div>
    </div>

    <main class="min-h-screen">
        <header class="bg-gradient-to-r from-[#5c7f67] to-[#4a6b57] text-white shadow-2xl">
            <div class="container mx-auto px-4 py-6">
                <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4">
                    <div class="flex-1">
                        <h1 class="text-3xl sm:text-4xl font-bold tracking-tight drop-shadow-lg">
                            üèóÔ∏è Civil Structural Design Suite
                        </h1>
                        <p class="text-blue-100 mt-2 flex items-center gap-2 text-sm sm:text-base">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/></svg>
                            Professional Engineering Tools ‚Ä¢ Refactored Engine v3.0
                        </p>
                    </div>
                    
                    <div class="flex flex-wrap items-center gap-3">
                        <div class="flex items-center gap-2 bg-white/20 backdrop-blur-sm px-3 py-2 rounded-xl">
                            <label for="unit-system" class="text-sm font-medium">Units:</label>
                            <select id="unit-system" class="bg-transparent text-white border-none focus:ring-0 text-sm">
                                <option value="metric" class="text-black">Metric (kN, m)</option>
                                <option value="imperial" class="text-black">Imperial (kips, ft)</option>
                            </select>
                        </div>

                        <button id="theme-toggle" class="flex items-center gap-2 bg-white/20 hover:bg-white/30 backdrop-blur-sm px-4 py-2 rounded-xl transition-all duration-300 hover:scale-105">
                            üåô Dark
                        </button>

                        <div class="flex gap-2">
                            <button id="export-project" class="bg-white/20 hover:bg-white/30 backdrop-blur-sm px-4 py-2 rounded-xl transition-all duration-300 hover:scale-105 text-sm font-medium">
                                üíæ Export
                            </button>
                            <input type="file" id="import-project" accept=".civiljson" class="hidden">
                            <button id="import-project-button" class="bg-white/20 hover:bg-white/30 backdrop-blur-sm px-4 py-2 rounded-xl transition-all duration-300 hover:scale-105 text-sm font-medium">
                                üìÇ Import
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <nav class="bg-white/95 backdrop-blur-sm border-b border-gray-200 sticky top-0 z-40 shadow-sm">
            <div class="container mx-auto px-4">
                <div class="flex flex-wrap gap-2 py-4 overflow-x-auto">
                    <button class="tab-button active" data-tab="beam-analysis">üìè Beam Analysis</button>
                    <button class="tab-button" data-tab="column-design">üèõÔ∏è Column Design</button>
                    <button class="tab-button" data-tab="slab-design">üß± Slab Design</button>
                    <button class="tab-button" data-tab="history">üìö History <span id="history-count" class="history-badge hidden"></span></button>
                </div>
            </div>
        </nav>

        <div class="container mx-auto px-4 py-8">
            <div id="beam-analysis" class="tab-content module-container">
                <div class="grid grid-cols-1 xl:grid-cols-4 gap-8">
                    <div class="xl:col-span-1 space-y-6">
                        <div class="result-card p-6">
                            <h3 class="text-xl font-bold text-gray-800 mb-4">1. Beam Properties</h3>
                            <div id="beam-visual" class="visual-box mb-6 rounded-xl">
                                <svg id="beam-svg" width="100%" height="120" viewBox="0 0 300 120"></svg>
                            </div>
                            <div class="space-y-4">
                                <div>
                                    <label for="beamType" class="input-label">Beam Type</label>
                                    <select id="beamType" class="form-input">
                                        <option value="simply-supported">Simply Supported</option>
                                        <option value="cantilever">Cantilever</option>
                                        <option value="fixed">Fixed Both Ends</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="beamLength" class="input-label">Span Length <span class="unit-label">(m)</span></label>
                                    <input type="number" id="beamLength" value="6.0" min="1" max="50" step="0.1" class="form-input">
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label for="beamWidth" class="input-label">Width <span class="unit-label">(mm)</span></label>
                                        <input type="number" id="beamWidth" value="230" min="100" max="1000" class="form-input">
                                    </div>
                                    <div>
                                        <label for="beamDepth" class="input-label">Depth <span class="unit-label">(mm)</span></label>
                                        <input type="number" id="beamDepth" value="450" min="150" max="2000" class="form-input">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="result-card p-6">
                            <h3 class="text-xl font-bold text-gray-800 mb-4">2. Loads & Materials</h3>
                            <div class="space-y-4">
                                <div>
                                    <label for="beamDL" class="input-label">Dead Load <span class="unit-label">(kN/m)</span></label>
                                    <input type="number" id="beamDL" value="10.0" min="0" step="0.1" class="form-input">
                                </div>
                                <div>
                                    <label for="beamLL" class="input-label">Live Load <span class="unit-label">(kN/m)</span></label>
                                    <input type="number" id="beamLL" value="15.0" min="0" step="0.1" class="form-input">
                                </div>
                                <div>
                                    <label for="beamFck" class="input-label">Concrete Grade</label>
                                    <select id="beamFck" class="form-input">
                                        <option value="20">M20</option>
                                        <option value="25" selected>M25</option>
                                        <option value="30">M30</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="beamFy" class="input-label">Steel Grade</label>
                                    <select id="beamFy" class="form-input">
                                        <option value="415">Fe415</option>
                                        <option value="500" selected>Fe500</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="beamCover" class="input-label">Cover <span class="unit-label">(mm)</span></label>
                                    <input type="number" id="beamCover" value="25" min="15" max="75" class="form-input">
                                </div>
                            </div>
                            <div class="mt-6 space-y-3">
                                <button id="runBeamButton" class="run-button w-full">üöÄ Run Analysis</button>
                                <button id="printBeamReport" class="print-button w-full no-print">üìÑ Generate Report</button>
                            </div>
                        </div>
                    </div>

                    <div class="xl:col-span-3 space-y-6">
                        <div id="beamStatus" class="status-visual hidden"></div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                            <div class="result-card-small">
                                <p class="result-label">Max Shear</p>
                                <p id="beamMaxShear" class="result-value">-</p>
                            </div>
                            <div class="result-card-small">
                                <p class="result-label">Max Moment</p>
                                <p id="beamMaxMoment" class="result-value">-</p>
                            </div>
                            <div class="result-card-small">
                                <p class="result-label">Max Deflection</p>
                                <p id="beamMaxDeflection" class="result-value">-</p>
                            </div>
                             <div class="result-card-small">
                                <p class="result-label">Utilization</p>
                                <p id="beamUtilization" class="result-value">-</p>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="result-card"><h3 class="result-title">Shear Force Diagram (SFD)</h3><div class="chart-container"><canvas id="sfd-chart"></canvas></div></div>
                            <div class="result-card"><h3 class="result-title">Bending Moment Diagram (BMD)</h3><div class="chart-container"><canvas id="bmd-chart"></canvas></div></div>
                        </div>

                        <div class="result-card">
                            <h3 class="result-title">Design Results</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4">
                                <div class="result-item"><span class="font-medium">Bottom Steel:</span><span id="beamBottomSteel" class="result-text">-</span></div>
                                <div class="result-item"><span class="font-medium">Top Steel:</span><span id="beamTopSteel" class="result-text">-</span></div>
                                <div class="result-item"><span class="font-medium">Shear Links:</span><span id="beamShearSteel" class="result-text">-</span></div>
                                <div class="result-item"><span class="font-medium">Deflection Check:</span><span id="beamDeflectionCheck" class="result-text">-</span></div>
                                <div class="result-item"><span class="font-medium">Moment Capacity:</span><span id="beamMomentCapacity" class="result-text">-</span></div>
                                <div class="result-item"><span class="font-medium">Shear Capacity:</span><span id="beamShearCapacity" class="result-text">-</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="column-design" class="tab-content hidden module-container">
                <p class="text-center text-gray-500 py-16">Column Design Module is under construction.</p>
            </div>

            <div id="slab-design" class="tab-content hidden module-container">
                <button class="tab-button" data-tab="bbs-design">üìã Bar Bending Schedule</button>
                 <p class="text-center text-gray-500 py-16">Slab Design Module is under construction.</p>
            </div>
            <div id="bbs-design" class="tab-content hidden module-container">
    <!-- Content will be generated by JavaScript -->
</div>

            <div id="history" class="tab-content hidden">
                <div class="result-card">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="result-title text-2xl">Calculation History</h3>
                        <button id="clear-history-btn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors">
                            üóëÔ∏è Clear All
                        </button>
                    </div>
                    <div id="history-list" class="space-y-3 max-h-96 overflow-y-auto"></div>
                </div>
            </div>
        </div>
    </main>

    <div id="toast-container"></div>

  <!-- Fix the script order - calculationEngine must load first -->
<script src="calculationEngine.js"></script>
<script src="chartManager.js"></script>
<script src="uiManager.js"></script>
<script src="app.js"></script>
</body>
</html>